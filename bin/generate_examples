#!/usr/bin/env ruby

require "date"
$LOAD_PATH.unshift File.expand_path("../lib", __dir__)
require "heatmap-builder"

EXAMPLES_DIR = File.expand_path("../examples", __dir__)

def example_path(filename)
  File.join(EXAMPLES_DIR, filename)
end

def generate_sample_svgs
  # Set fixed random seed for reproducible examples
  srand(42)

  Dir.mkdir(EXAMPLES_DIR) unless Dir.exist?(EXAMPLES_DIR)

  puts "Generating basic weekly progress..."

  weekly_scores = [0, 1, 3, 2, 4, 1, 0]
  svg = HeatmapBuilder.generate(weekly_scores, cell_size: 18)
  filepath = example_path("weekly_progress.svg")
  File.write(filepath, svg)

  puts filepath
  puts

  puts "Generating large cells example..."

  large_cell_scores = [1, 2, 3, 4, 5, 6, 7]
  svg = HeatmapBuilder.generate(large_cell_scores, {
    cell_size: 35,
    cell_spacing: 1,
    font_size: 20
  })

  filepath = example_path("large_cells.svg")
  File.write(filepath, svg)

  puts filepath
  puts

  puts "Generating linear heatmaps with different palettes..."

  linear_scores = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]

  # GitHub Green palette (default)
  svg = HeatmapBuilder.build_linear(linear_scores, {
    colors: HeatmapBuilder::GITHUB_GREEN,
    cell_size: 18
  })

  filepath = example_path("linear_github_green.svg")
  File.write(filepath, svg)

  puts filepath
  puts

  # Blue Ocean palette
  svg = HeatmapBuilder.build_linear(linear_scores, {
    colors: HeatmapBuilder::BLUE_OCEAN,
    cell_size: 18
  })

  filepath = example_path("linear_blue_ocean.svg")
  File.write(filepath, svg)

  puts filepath
  puts

  # Warm Sunset palette
  svg = HeatmapBuilder.build_linear(linear_scores, {
    colors: HeatmapBuilder::WARM_SUNSET,
    cell_size: 18
  })

  filepath = example_path("linear_warm_sunset.svg")
  File.write(filepath, svg)

  puts filepath
  puts

  # Purple Vibes palette
  svg = HeatmapBuilder.build_linear(linear_scores, {
    colors: HeatmapBuilder::PURPLE_VIBES,
    cell_size: 18
  })

  filepath = example_path("linear_purple_vibes.svg")
  File.write(filepath, svg)

  puts filepath
  puts

  # Red to Green palette
  svg = HeatmapBuilder.build_linear(linear_scores, {
    colors: HeatmapBuilder::RED_TO_GREEN,
    cell_size: 18
  })

  filepath = example_path("linear_red_to_green.svg")
  File.write(filepath, svg)

  puts filepath
  puts

  puts "Generating GitHub-style calendar..."

  calendar_data = sample_calendar_data
  svg = HeatmapBuilder.build_calendar(calendar_data, {
    cell_size: 14,
    month_spacing: 0
  })

  filepath = example_path("calendar_github_style.svg")
  File.write(filepath, svg)

  puts filepath
  puts

  puts "Generating default colors calendar..."

  svg = HeatmapBuilder.build_calendar(calendar_data, {
    cell_size: 14,
    month_spacing: 0
  })

  filepath = example_path("calendar_default.svg")
  File.write(filepath, svg)

  puts filepath
  puts

  puts "Generating calendar with Blue Ocean palette..."

  svg = HeatmapBuilder.build_calendar(calendar_data, {
    colors: HeatmapBuilder::BLUE_OCEAN,
    cell_size: 14,
    month_spacing: 0
  })

  filepath = example_path("calendar_blue_ocean.svg")
  File.write(filepath, svg)

  puts filepath
  puts

  puts "Generating calendar with Warm Sunset palette..."

  svg = HeatmapBuilder.build_calendar(calendar_data, {
    colors: HeatmapBuilder::WARM_SUNSET,
    cell_size: 14,
    month_spacing: 0
  })

  filepath = example_path("calendar_warm_sunset.svg")
  File.write(filepath, svg)

  puts filepath
  puts

  puts "Generating calendar with Purple Vibes palette..."

  svg = HeatmapBuilder.build_calendar(calendar_data, {
    colors: HeatmapBuilder::PURPLE_VIBES,
    cell_size: 14,
    month_spacing: 0
  })

  filepath = example_path("calendar_purple_vibes.svg")
  File.write(filepath, svg)

  puts filepath
  puts

  puts "Generating calendar with Red to Green palette..."

  svg = HeatmapBuilder.build_calendar(calendar_data, {
    colors: HeatmapBuilder::RED_TO_GREEN,
    cell_size: 14,
    month_spacing: 0
  })

  filepath = example_path("calendar_red_to_green.svg")
  File.write(filepath, svg)

  puts filepath
  puts

  puts "Generating calendar with Sunday start..."

  svg = HeatmapBuilder.build_calendar(calendar_data, {
    cell_size: 14,
    start_of_week: :sunday,
    month_spacing: 0
  })

  filepath = example_path("calendar_sunday_start.svg")
  File.write(filepath, svg)

  puts filepath
  puts

  puts "Generating calendar with outside cells..."

  svg = HeatmapBuilder.build_calendar(calendar_data, {
    cell_size: 14,
    show_outside_cells: true,
    month_spacing: 0
  })

  filepath = example_path("calendar_with_outside_cells.svg")
  File.write(filepath, svg)

  puts filepath
  puts

  puts "Generating linear with rounded corners..."

  svg = HeatmapBuilder.build_linear(linear_scores, {
    colors: HeatmapBuilder::GITHUB_GREEN,
    cell_size: 18,
    corner_radius: 2
  })

  filepath = example_path("linear_rounded_corners.svg")
  File.write(filepath, svg)

  puts filepath
  puts

  puts "Generating linear with rounded corners (max radius)..."

  svg = HeatmapBuilder.build_linear(linear_scores, {
    colors: HeatmapBuilder::GITHUB_GREEN,
    cell_size: 18,
    corner_radius: 9
  })

  filepath = example_path("linear_rounded_corners_max_radius.svg")
  File.write(filepath, svg)

  puts filepath
  puts

  puts "Generating calendar with rounded corners..."

  svg = HeatmapBuilder.build_calendar(calendar_data, {
    cell_size: 14,
    corner_radius: 2,
    month_spacing: 0
  })

  filepath = example_path("calendar_rounded_corners.svg")
  File.write(filepath, svg)

  puts filepath
  puts

  puts "Generating calendar with rounded corners (max radius)..."

  svg = HeatmapBuilder.build_calendar(calendar_data, {
    cell_size: 14,
    corner_radius: 7,
    month_spacing: 0
  })

  filepath = example_path("calendar_rounded_corners_max_radius.svg")
  File.write(filepath, svg)

  puts filepath

  puts "\nDone"
end

def sample_calendar_data
  # Generate sample data for a full year
  current_year = Date.today.year
  start_date = Date.new(current_year, 1, 1)
  end_date = Date.new(current_year, 12, 31)

  data = {}
  current_date = start_date

  while current_date <= end_date
    # Create some realistic activity patterns with seasonal variation
    base_activity = case current_date.month
    when 1, 2, 12 # Winter - lower activity
      [0, 0, 0, 1, 1, 2]
    when 3, 4, 5 # Spring - increasing activity
      [0, 1, 1, 2, 2, 3, 3]
    when 6, 7, 8 # Summer - peak activity
      [1, 2, 2, 3, 3, 4, 4, 5]
    when 9, 10, 11 # Fall - moderate activity
      [0, 1, 2, 2, 3, 3]
    end

    # Weekend vs weekday patterns
    score = case current_date.wday
    when 0, 6 # Weekend - reduced activity
      ([0, 0] + base_activity.take(3)).sample
    else # Weekday - normal patterns
      base_activity.sample
    end

    data[current_date.to_s] = score

    current_date += 1
  end

  data
end

# Run the generator
if __FILE__ == $0
  generate_sample_svgs
end
